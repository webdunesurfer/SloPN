services:
  slopn-server:
    build: .
    container_name: slopn-server
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    ports:
      - "4242:4242/udp"
    environment:
      - SLOPN_TOKEN=your-secret-token
      - SLOPN_NAT=true
      - SLOPN_VERBOSE=false
      - SLOPN_MAX_ATTEMPTS=5
      - SLOPN_WINDOW=5
      - SLOPN_BAN_DURATION=60
    command: ["-nat", "-token", "your-secret-token"]

  slopn-dns:
    image: coredns/coredns:latest
    container_name: slopn-dns
    restart: unless-stopped
    ports:
      - "10.100.0.1:53:53/udp"
      - "10.100.0.1:53:53/tcp"
    volumes:
      - ./coredns.conf:/etc/coredns/Corefile
    command: -conf /etc/coredns/Corefile
